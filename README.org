#+STARTUP: indent

* 環境設定
** 共通(osx)
- nodeが既にインストールされているかの確認
  nodebrew上にnodejsをインストールしたいので既存のnodeは削除する

#+begin_src 
$ node --version
#+end_src

- nodebrewのインストール
#+begin_src shell
$ curl -L git.io/nodebrew | perl - setup
#+end_src

- bashrcにpathを追加
#+begin_src shell
$ vi ~/.bashrc
export PATH=$HOME/.nodebrew/current/bin:$PATH

$ source ~/.bashrc
#+end_src

- nodejs本体をインストール
#+begin_src shell
$ nodebrew install v6.11.0
$ nodebrew use v6.11.0
$ node --version
v6.11.0
#+end_src

- 任意のパスにcloud storageのリポジトリをclone
#+begin_src shell
$ cd /path/to/work
$ git clone https://github.com/knb-wkm/walter-02.git
#+end_src

** サーバサイド

- npm
#+begin_src shell
$ cd /path/to/walter-02
$ cd server
$ npm install
#+end_src

- 起動
#+begin_src shell
$ npm start
#+end_src

** フロントエンド

- npm
#+begin_src shell
$ cd /path/to/walter-02
$ cd client
$ npm install
#+end_src

- 起動
#+begin_src shell
$ npm start
#+end_src

** コンテナを作成
- 事前にmongo, openstack-swiftのコンテナを作成しておく
- docker serverに以下の内容をdocker-compose.ymlとして保存する
#+begin_src yaml
version: "2"
services:
  mongo:
    container_name: "walter-db2"
    image: "mongo"
    privileged: true
    networks:
      platform:
        ipv4_address: 172.16.55.xx
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
      - "/tmp:/tmp"
    environment:
      LANG: "ja_JP.UTF-8"
  swift:
    container_name: "walter-swift2"
    image: "morrisjobke/docker-swift-onlyone"
    privileged: true
    networks:
      platform:
        ipv4_address: 172.16.55.xx
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
      - "/tmp:/tmp"
    environment:
      LANG: "ja_JP.UTF-8"
networks:
  platform:
    external: true
#+end_src

- docker-compose実行
#+begin_src shell
$ sudo /usr/local/bin/docker-compose -d up
#+end_src

** mongoのセットアップ

- mongoをインストール
#+begin_src shell
$ brew install mongodb
#+end_src

- データ投入
#+begin_src shell
$ cd /path/to/walter-02/server/jobs

# 部内Dockerのmongodbを指定する
$ mongo 172.16.55.xx/walter --quiet localTestData.js
#+end_src

** openstack swiftのセットアップ

- swift上にwalterのコンテナ(swiftでいうところのコンテナ)を作成する
- swiftのdocker containerにbashにてログインしコンテナを作成
#+begin_src shell
$ sudo docker exec -it walter-swiftx /bin/bash
$ swift -A http://127.0.0.1:8080/auth/v1.0 -U test:tester -K testing post walter
#+end_src

